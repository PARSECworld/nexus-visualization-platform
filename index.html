<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;1,300&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/1fdc740535.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <title>Nexus Web App</title>
</head> 
<body>
    <div class="placeholder"></div>
    <div class="header">
        <div class="logo-container">
            <a href="https://parsecproject.org/">
                <img id="parsec" class="logo" src="media/PARSEC-LOGO.jpg" style="height: 85;width: 111px;"></img>
                <img id="nexus" class="logo" src="media/NEXUS-LOGO.png" style="height: 90px;width: 137px;"></img>
            </a>
        </div>
        <div class="header-menu">
            <div id="metodologia" class="button" value="method">
                Metodologia
            </div>
            <div id="projeto"     class="button" value="project">
                Projeto
            </div>
            <div id="plataforma"  class="button active" value="app">
                Plataforma
            </div>
        </div>
    </div>
    <div class="workspace">
        <div id="app" class="page active">
            <form name="app_configs" method="post" id="app_configs"></form>
            <div class="side-bar">
                <button class="side-bar-menu-btn" onclick="expand(this, 'menu')">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
            <div id="menu" class="collapsible menu" value="0px,100%">
                <div id="year" class="field" style="padding-top: 25px;">
                    <div class="label">Ano de predição</div>
                    <div class="large field-box">
                        <select id="year-text" class="drop-down" form="app_configs">
                            <option value="2010">2010</option>
                            <!-- <option value="2015">2015</option> -->
                        </select>
                    </div>
                    <div id="option">
                        <div class="label">ou</div>
                        <div class="field-box">
                            <input class="input" placeholder="Digite um ano específico" disabled></input>
                        </div>
                    </div>
                </div>
                <div id="granular" class="field" style="padding-top: 73px;">
                    <div class="label">Resolução</div>
                    <div class="large field-box">
                        <select id="granular-menu" class="drop-down" form="app_configs">
                            <!-- <option value="region">5 regiões geoeconômicas</option> -->
                            <option value="states">Estados</option>
                            <option value="municipalities">Municípios</option>
                        </select>
                    </div>
                </div>
                <div id="index" class="field" style="padding-top: 73px;">
                    <div class="label">Indicador</div>
                    <div class="large field-box">
                        <select id="index-menu" class="drop-down" form="app_configs">
                            <option value="income">Renda</option>
                            <option value="literacy">Alfabetização</option>
                            <option value="longevity">Longevidade</option>
                        </select>
                    </div>
                </div>
                <!-- <div id="selection">
                    <div class="selection-mode">
                        <div class="btn-text">Selecionar áreas no mapa</div>
                        <div class="menu-icon">
                            <i class="fa-solid fa-map-marked-alt"></i>
                        </div>
                    </div>
                </div>
                <div class="user-request-container">
                    <div class="user-request-btn visualize-btn inactive">
                        <div class="btn-text">Visualizar</div>
                        <div class="menu-icon">
                            <i class="fa-solid fa-eye"></i>
                        </div>
                    </div>
                    <div class="user-request-btn download-btn inactive">
                        <div class="btn-text">Download</div>
                        <div class="menu-icon">
                            <i class="fa-solid fa-file-csv"></i>
                        </div>
                    </div>
                </div> -->
            </div>
            <div class="earth-engine-app">
                <div class="loader" style="z-index:2;"></div>
                <div class="colorbar-container">
                    <div class="colorbar" style="z-index:2;display:none;"></div>
                    <div class="cbar-label" id="cbar-max" style="z-index:1;"></div>
                    <div class="cbar-label" id="cbar-min" style="z-index:1;"></div>
                </div>
                <iframe class="EE-Scripted-Map" name="EE-Scripted-Map" id="innerFrame" sandbox="allow-scripts allow-popups allow-forms allow-same-origin
                allow-popups-to-escape-sandbox allow-downloads" frameborder="0" style="overflow:auto;z-index:1;"
                src="src/earthengineapp.html" onload="document.getElementsByClassName('loader')[0].style.display = 'none'; document.getElementsByClassName('colorbar')[0].style.display = 'block'"></iframe>
            </div>
        </div>
        <div id="project" class="page">
            <div class="text-container">
                <div class="title">
                    <p>Estimativa de indicadores socioeconômicos a partir de imagens de satélite na área NEXUS</p>
                </div>
                <img id="nexusarea" src="media/nexusarea.png" style="width: 483.75px;height: 339px;"><p id="nexusarea-legend">A área NEXUS corresponde a aproximadamente 40% da área do país.</p></img>
                <div id="project-description">
                    <p>O projeto Parsec tem por objetivo aplicar técnicas de Data Science e Aprendizado de Máquina voltadas para aplicações de gerenciamento e preservação da biodiversidade mundial. Em parceria com a Universidade de São Paulo e o Instituto Nacional de Pesquisas Espaciais (INPE), está sendo conduzido um estudo na área NEXUS, uma região de aproximadamente 3,4 milhões de quilômetros quadrados dentro do território brasileiro, cobrindo as bacias hidrográficas do Rio São Francisco e Rio Parnaíba.</p>
                    <p>O projeto de formatura auxilia neste estudo e propõe, inspirado em trabalhos semelhantes realizados no continente africano em anos anteriores, a estimativa de indicadores de renda, longevidade e alfabetização em toda esta área, utilizando imagens de satélite disponíveis publicamente pela API do Google Earth Engine. A contribuição deste trabalho é a criação e documentação passo a passo de uma metodologia para estimar indicadores no território brasileiro através do treinamento de modelos de Deep Learning utilizando imagens de satélite, além de propor um protótipo de uma plataforma interativa na Internet para a visualização dos indicadores estimados no mapa brasileiro.</p>
                    <p>O trabalho também contribui com a criação de um novo conjunto de dados, originado da mescla de um conjunto contendo mais de 100 indicadores socioeconômicos fornecidos pelo INPE e as informações administrativas, geográficas e geométricas dos setores censitários brasileiros fornecidas pelo IBGE.</p>
                    <p>Modelos de Deep Learning foram treinados usando o backbone de uma ResNet-18 para estimar indicadores socioeconômicos usando imagens multiespectral e noturna. Observou-se que os experimentos multiespectral eram apropriados para prever os valores alvo sobre o conjunto de dados proposto, enquanto os modelos usando apenas luzes noturnas desempenharam abaixo das expectativas devido a limitações de dados. Tendo em vista os resultados obtidos, entende-se que a metodologia proposta por este trabalho é adequada para a estimativa de indicadores socioeconômicos no cenário brasileiro.</p>
                    <p>O projeto demonstra a possibilidade de estimar indicadores socioeconômicos a partir de imagens de satélite para o caso brasileiro. Os modelos permitiram uma série de experimentações em imagens multiespectrais e noturnas levando ao entendimento das suas relações com os indicadores socioeconômicos e, para para as bandas multiespectrais, a correlação obtida entre os indicadores preditos e os reais é de até 42%, o que comprova a capacidade preditiva dos modelos no dataset proposto.</p>
                </div>
                <img id="tableincome" src="media/income_table.png" style="margin-top:22px"></img>
            </div>
        </div>
        <div id="method" class="page">
            <div class="text-container">
                <div class="title">
                    <p>Descrição da metodologia proposta.</p>
                </div>
                <div id="workflow-description">
                    <p>A parte do workflow desenvolvida pelos autores parte da obtenção e filtragem de indicadores na granularidade de setores censitários. Os 3 indicadores considerados como relevantes para estudar o desenvolvimento socioeconômico de comunidades são longevidade, renda e alfabetização. Em sequência, é realizada a seleção das regiões das imagens de satélite exige um critério rigoroso com condições que visam a garantir um modelo não enviesado e redução do custo de armazenamento: (a) cada imagem deve representar apenas um tipo de setor: urbano ou rural, (b) estes dois tipos devem estar disponíveis na base de dados em uma proporção que retrate a realidade, (c) uma determinada região só deve estar presente em apenas uma imagem selecionada. O projeto propõe duas estratégias para a seleção: Random Sampling e Neighboring Graphs.</p>
                    <p>Já se baseando no workflow proposto pelo artigo de referência, Yeh. et al (2020), as imagens dos clusters selecionados são coletadas por meio da API do Google Earth Engine, informando seu centróide, escala (30 metros/pixel), resolução (224 x 224 pixels) e ano (2010).</p>
                    <p>Os experimentos de Deep Learning estimam índices de riqueza em diversos países Africanos por meio de 3 redes neurais: MS, NL e MS+NL. A estrutura de MS+NL (Figura 2) apresenta entrada dupla: imagens de satélite diurnas (MS) e imagens noturnas (NL). O modelo conta com dois backbones de Resnet 18 pré-treinados para a extração de features das imagens. A camada fully connected combina as informações extraídas das entradas para uma regressão de Ridge. A avaliação da capacidade do modelo de explicar os indicadores estimados se dá por 4 métricas: coeficiente de correlação de pearson (r²), coeficiente de determinação (R²), mean squared error (MSE) e correlação de spearman (rank).</p>
                </div>
                <img id="dataflow" src="media/Model_Workflow_PT.png" style="width: 90%;"></img>
            </div>
        </div>
        <div class="side-box">
            <div class="authors">
                <p class="t">Autores</p>
                <p class="a">Carlos Massao Oishi Giuzio</p>
                <p class="e"><i class="fa-solid fa-envelope"></i>carlosgiuzio@usp.br</p>
                <p class="a">Igor Varela Zoeller</p>
                <p class="e"><i class="fa-solid fa-envelope"></i>igorzoeller@usp.br</p>
                <p class="a">Rafael Araujo Coelho</p>
                <p class="e"><i class="fa-solid fa-envelope"></i>rafaelcoelho@usp.br</p>
            </div>
            <div class="ack">
                <p class="t">Orientação e Coorientação</p>
                <p class="a">Prof. Dr. Pedro Luiz Pizigatti Corrêa</p>
                <p class="e"><i class="fa-solid fa-envelope"></i>pedro.correa@usp.br</p>
                <p class="a">Dra. Marina Jeaneth Machicao Justo</p>
                <p class="e"><i class="fa-solid fa-envelope"></i>machicao@usp.br</p>
            </div>
        </div>
    </div>
    <script>
        function expand(btn, expandable_item_id) {
            btn.classList.toggle("active");
            var item = document.getElementById(expandable_item_id);
            const minValues = item.getAttribute("value").split(",");
            const minWidth  = minValues[0];
            const minHeight = minValues[1];
            var style = window.getComputedStyle(item);
            if (!btn.classList.contains("active")) {
                item.style.width  = minWidth;
                item.style.height = minHeight;
            } else {
                item.style.width  = style.maxWidth;
                item.style.height = style.maxHeight;
            }
            console.log(item.style.width);
        }
    </script>
    <script>
        function addRuleKeepOnlyOneActive(target, sharedClassElements) {
            target.addEventListener("click", function() {
                for (let j = 0; j < sharedClassElements.length; j++) {
                    var element = sharedClassElements[j];
                    const value = element.getAttribute("value");
                    var relatedElement = document.getElementById(value);
                    if (!(element === target)) {
                        element.classList.remove("active");
                        relatedElement.classList.remove("active");
                    } else {
                        var side_box = document.getElementsByClassName("side-box")[0];
                        console.log(side_box);
                        console.log(element.id);
                        if (element.id == "projeto" || element.id == "metodologia") {
                            side_box.classList.add("active");
                        } else {
                            side_box.classList.remove("active");
                        }
                        element.classList.add("active");
                        relatedElement.classList.add("active");
                    }
                }
            });
        }

        var buttons = document.getElementsByClassName("button");
        for (let i = 0; i < buttons.length; i++) {
            addRuleKeepOnlyOneActive(buttons[i], buttons);
        }
    </script>
    <script>
        $('select#granular-menu').change(function() {
            var layer = $('select#granular-menu').val(); // municipalities; states
            console.log(layer);
            document.getElementById("innerFrame").contentWindow.postMessage(layer, "src/earthengineapp.html");
        });
        $('select#index-menu').change(function() {
            var indicator = $('select#index-menu').val();
            console.log(indicator);
            document.getElementById("innerFrame").contentWindow.postMessage(indicator, "src/earthengineapp.html");
        })
        window.addEventListener('message', function() {
            console.log(event.data);
            var messageContent = event.data;
            if (messageContent == 'loadingMap') {
                document.getElementById('innerFrame').style.opacity = "0.4";
                document.getElementsByClassName("colorbar-container")[0].style.opacity = "0.4";
                document.getElementsByClassName('loader')[0].style.display = 'block';
                document.getElementsByClassName('loader')[0].style.opacity = '1.0';
                setTimeout(function() {
                    document.getElementById("innerFrame").contentWindow.postMessage('load', "src/earthengineapp.html");
                }, 500);
            } else if (messageContent == 'loadedMap') {
                document.getElementById('innerFrame').style.opacity = "1.0";
                document.getElementsByClassName("colorbar-container")[0].style.opacity = "1.0";
                document.getElementsByClassName('loader')[0].style.display = 'none';
            } else if (messageContent.startsWith("scores")) {
                var content = messageContent.split("_");
                var maxScore = content[1];
                var minScore = content[2];
                document.getElementById("cbar-max").innerHTML = maxScore;
                document.getElementById("cbar-min").innerHTML = minScore;
            }
        });
    </script>
</body>
</html>
